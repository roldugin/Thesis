%\documentclass{article}

%\PassOptionsToPackage{usenames,dvipsnames}{xcolor}
%\usepackage{fixltx2e}
%\usepackage{listings}
%\usepackage{xcolor}

% Define styles for GoTo labels and subscripts

\newcommand\labelcolor{\color{RoyalPurple}}
%\colorlet{gotolabel}{MidnightBlue}
\newcommand\lstsubstyle{\itshape\rmfamily}
\newcommand\gotolabelstyle{\ttfamily\labelcolor}


% 
\lstdefinestyle{lfloop}{%
  basicstyle=\ttfamily\upshape\color{black},
  columns=fullflexible,
  moredelim=**[il][\processgoto]{goto\ },
  moredelim=**[il][\processpipe]{\ |\ },
  literate={\ \ }{\processtwospaces}2
           {:}{\processcolon}1,
}

\newif\ifgotolabel

\makeatletter

\lst@AddToHook{EveryPar}{%
  \let\lst@thestyle\gotolabelstyle%
  \global\gotolabeltrue%
}

\newcommand\processgoto{%
  \lst@CalcLostSpaceAndOutput%
  {\lst@basicstyle goto\ }\gotolabelstyle%
}

\newcommand\processpipe{%
  \lst@CalcLostSpaceAndOutput%
  {\lst@basicstyle\ |\ }\gotolabelstyle%
}

\newcommand\lstsub[1]{%
  \textsubscript{%
    \ifgotolabel%
      \labelcolor%
    \fi
    \lstsubstyle #1%
  }%
}

\newcommand\processtwospaces{%
  \ifnum\lst@mode=\lst@Pmode%
    \lst@basicstyle%
    \global\gotolabelfalse%
  \fi
  \ \ %
}

\newcommand\processcolon{%
  \ifnum\lst@mode=\lst@Pmode%
    \lst@basicstyle%
    \global\gotolabelfalse%
  \fi
  :%
}

\makeatother


% \begin{document}
% \begin{lstlisting}

% init_2:
%   i_1 = 0
%   arr_2 = newArray (length arr_1)
%   goto guard_2

% guard_2:
%   guard i_1 < length arr_1 | done_2
%   goto body_2

% body_2:
%   elt_1 = readArray arr_1 i_1
%   elt_2 = f_2 elt_1
%   writeArray arr_2 i_1
%   i_1 := i_1 + 1
%   goto guard_2

% done_2:
%   return arr_2
% \end{lstlisting}
% \end{document}